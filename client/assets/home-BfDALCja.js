import{a as s,p as e,w as U}from"./chunk-UIGDSWPH-4ZIJcO7e.js";import{f as g,g as Y,T as I,s as $,a as F,h as P,b as q,c as G,d as T}from"./moment-D9XNBQqi.js";const B=t=>{const o=s.useRef(null);return s.useEffect(()=>{const n=a=>{o.current&&!o.current.contains(a.target)&&t()};return document.addEventListener("mouseup",n),document.addEventListener("touchend",n),()=>{document.removeEventListener("mouseup",n),document.removeEventListener("touchend",n)}},[t]),o};function W(){return e.jsxs("svg",{width:"15px",height:"15px",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("rect",{width:"24",height:"24",fill:"white"}),e.jsx("path",{d:"M7 17L16.8995 7.10051",stroke:"#000000",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M7 7.00001L16.8995 16.8995",stroke:"#000000",strokeLinecap:"round",strokeLinejoin:"round"})]})}function X(){return e.jsx("svg",{fill:"#000000",width:"30px",height:"20px",viewBox:"0 0 50 50",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",children:e.jsx("path",{d:"M15 5 A 1.0001 1.0001 0 0 0 14 6L14 25L7 25 A 1.0001 1.0001 0 0 0 6 26L6 29.716797L0.048828125 43.605469 A 1.0001 1.0001 0 0 0 0.96679688 45L49.140625 45 A 1.0001 1.0001 0 0 0 50.046875 43.576172L44 30.621094L44 22 A 1.0001 1.0001 0 0 0 43 21L37 21L37 14 A 1.0001 1.0001 0 0 0 36 13L29 13L29 6 A 1.0001 1.0001 0 0 0 28 5L15 5 z M 16 7L27 7L27 13L23 13 A 1.0001 1.0001 0 0 0 22 14L22 25L16 25L16 7 z M 18 9L18 11L20 11L20 9L18 9 z M 23 9L23 11L25 11L25 9L23 9 z M 18 13L18 15L20 15L20 13L18 13 z M 24 15L35 15L35 21L31 21 A 1.0001 1.0001 0 0 0 30 22L30 39L24 39L24 26L24 15 z M 18 17L18 19L20 19L20 17L18 17 z M 26 17L26 19L28 19L28 17L26 17 z M 31 17L31 19L33 19L33 17L31 17 z M 18 21L18 23L20 23L20 21L18 21 z M 26 21L26 23L28 23L28 21L26 21 z M 32 23L42 23L42 39L34 39L32 39L32 23 z M 26 25L26 27L28 27L28 25L26 25 z M 34 25L34 27L36 27L36 25L34 25 z M 38 25L38 27L40 27L40 25L38 25 z M 8 27L22 27L22 39L8 39L8 27 z M 10 29L10 31L12 31L12 29L10 29 z M 14 29L14 31L16 31L16 29L14 29 z M 18 29L18 31L20 31L20 29L18 29 z M 26 29L26 31L28 31L28 29L26 29 z M 34 29L34 31L36 31L36 29L34 29 z M 38 29L38 31L40 31L40 29L38 29 z M 10 33L10 35L12 35L12 33L10 33 z M 14 33L14 35L16 35L16 33L14 33 z M 18 33L18 35L20 35L20 33L18 33 z M 26 33L26 35L28 35L28 33L26 33 z M 34 33L34 35L36 35L36 33L34 33 z M 38 33L38 35L40 35L40 33L38 33 z M 6 34.796875L6 40 A 1.0001 1.0001 0 0 0 7 41L23 41L34 41L43 41 A 1.0001 1.0001 0 0 0 44 40L44 35.349609L47.570312 43L2.484375 43L6 34.796875 z"})})}function A(){return e.jsx("div",{className:"loader"})}const E=s.createContext(null),J=({children:t})=>{const[o,n]=s.useState([]);return e.jsx(E.Provider,{value:{hotels:o,setHotels:n},children:t})},O=s.createContext(null),K=({children:t})=>{const[o,n]=s.useState([]);return e.jsx(O.Provider,{value:{offers:o,setOffers:n},children:t})};function Q({countries:t,placeholder:o,selectedPlaces:n,setSelectedPlaces:a,inputText:L,setInputText:l,places:C,searchResponse:f,setSearchResponse:i}){const[w,c]=s.useState(!1),h=s.useRef(null),[x,d]=s.useState(""),[M,S]=s.useState(!1),v=s.useContext(E),u=s.useContext(O);if(!v||!u)throw new Error(`Context must be used within a ${v?"OffersContext":"HotelsContext"}`);const{offers:N,setOffers:z}=u,{hotels:m,setHotels:p}=v,k=B(()=>{c(!1)}),b=r=>{a(r),l(r.name),c(!1)},D=s.useCallback(()=>{n.type==="country"&&g(Y(n.id)).then(async r=>{const j=await r.json();Object.values(j).length>0&&!m.map(R=>R.countryId).includes(+(n?.id??0))&&p([...m,{countryId:+n.id,hotels:Object.values(j)}])})},[n]),_=async()=>{await g(F(f.token),d,S).finally(()=>i({token:"",waitUntil:null}))},H=r=>{f.token&&_(),d(""),i({...f,waitUntil:null}),r.preventDefault(),n&&(g($(n.id),d,S).then(j=>{if(!j.ok)throw new Error(`Server error: ${j.status}`);return j.json()}).then(j=>i(j)),z([]),D())};return e.jsxs("form",{className:"dropdown",onSubmit:r=>H(r),children:[e.jsx("span",{className:"dropdown-title",children:o}),e.jsxs("div",{className:"dropdown-header",children:[e.jsx("input",{id:"inputText",type:"text",className:"dropdown-header__input",value:L,placeholder:o,onChange:r=>{l(r.target.value),a(null)},onClick:()=>{L===o&&l(""),c(!0)},ref:h}),e.jsx("button",{type:"button",className:"dropdown-header__button",onClick:()=>{h.current&&h.current.focus(),l(""),a(null),c(!0)},children:e.jsx(W,{})})]}),e.jsx("div",{ref:k,children:w&&e.jsx("ul",{className:"dropdown-menu",children:L.length===0||n&&n.type==="country"?t.map(r=>e.jsxs("li",{className:"dropdown-item",onClick:()=>b({...r,type:"country"}),children:[e.jsx("img",{src:r.flag,className:"dropdown-item__image"}),e.jsx("span",{children:r.name})]},r.id)):C.map(r=>e.jsxs("li",{className:"dropdown-item",onClick:()=>b(r),children:[r.type==="city"?e.jsx(X,{}):e.jsx("img",{src:r.type==="country"?r.flag:r.img,className:"dropdown-item__image"}),e.jsx("span",{children:r.name})]},r.id))})}),e.jsx("button",{type:"submit",className:"dropdown-button",disabled:!n||M,children:M?e.jsx(A,{}):"Знайти"}),x.length>0&&e.jsx(I,{error:x})]})}const y=s.createContext(null),V=({children:t})=>{const[o,n]=s.useState(null);return e.jsx(y.Provider,{value:{searchResults:o,setSearchResults:n},children:t})};function Z({item:t}){return e.jsxs("div",{className:"offer",children:[t.hotel?.img&&e.jsx("img",{src:t.hotel.img,className:"offer-image",loading:"lazy"}),e.jsx("span",{className:"offer-title",children:t.hotel?.name}),e.jsxs("span",{className:"offer-address",children:[t.hotel?.countryName,", ",t.hotel?.cityName]}),e.jsx("span",{className:"offer-start",children:"Старт тура"}),e.jsx("span",{className:"offer-date",children:P(t.priceOffer?.startDate,"YYYY-MM-DD").format("DD.MM.YYYY")}),e.jsxs("span",{className:"offer-amout",children:[t.priceOffer?.amount&&new Intl.NumberFormat("uk-UA",{useGrouping:!0}).format(t.priceOffer?.amount)," ",t.priceOffer?.currency]}),e.jsx("a",{href:`/tour?priceId=${t.priceOffer?.id}&hotelId=${t.priceOffer?.hotelID}`,className:"offer-link",children:"Відкрити ціну"})]})}function ee(){const t=s.useContext(O);if(!t)throw new Error("Context must be used within a OffersContext");const{offers:o}=t;return e.jsx("div",{className:"offers",children:o.sort((n,a)=>(n.priceOffer?.amount??0)-(a.priceOffer?.amount??0)).map(n=>e.jsx(Z,{item:n},n.priceOffer?.id))})}function te({searchResponse:t,setSearchResponse:o}){const[n,a]=s.useState(!1),[L,l]=s.useState(""),[C,f]=s.useState(!1),i=s.useContext(y),w=s.useContext(E),c=s.useContext(O);if(!i||!w||!c)throw new Error(`Context must be used within a ${y?c?"HotelsContext":"OffersContext":"SearchResultsContext"}`);const{searchResults:h,setSearchResults:x}=i,{hotels:d}=w,{offers:M,setOffers:S}=c,v=()=>{t.waitUntil&&new Date(t.waitUntil)<new Date&&a(!0)};return s.useEffect(()=>{if(t.waitUntil){l(""),f(!0),v();const u=setInterval(v,1e3);return()=>clearInterval(u)}},[t.waitUntil]),s.useEffect(()=>{n&&g(q(t.token),l,f).then(u=>{if(!u.ok)throw new Error(`Server error: ${u.status}`);return u.json()}).then(u=>{const N=Object.values(u.prices),z=[];x(N),d.map(m=>{m.hotels?.map(p=>{z.push(p)})}),N.map(m=>{M.map(p=>p.priceOffer?.hotelID).includes(m.hotelID)||z.map(p=>{+(m.hotelID??0)===p.id&&S(k=>[...k,{priceOffer:m,hotel:p}])})})}).finally(()=>{a(!1),f(!1),o({...t,waitUntil:null})})},[n]),e.jsxs("div",{className:"search-results",children:[C?e.jsx("div",{className:"search-results__spinner",children:e.jsx(A,{})}):h?.length===0&&e.jsx("span",{className:"search-results__empty",children:"За вашим запитом турів не знайдено"}),L.length>0&&e.jsx(I,{error:L}),e.jsx(ee,{})]})}const se=({children:t})=>e.jsx(K,{children:e.jsx(J,{children:e.jsx(V,{children:t})})});function ne(){const[t,o]=s.useState([]),[n,a]=s.useState([]),[L,l]=s.useState(""),[C,f]=s.useState(null),[i,w]=s.useState(""),[c,h]=s.useState({token:"",waitUntil:null});return s.useEffect(()=>{g(G(),l).then(async x=>{const d=await x.json();return o(Object.values(d))})},[]),s.useEffect(()=>{i.length>0&&g(T(i),l).then(async x=>{const d=await x.json();return a(Object.values(d))})},[i]),e.jsx(se,{children:e.jsx("main",{children:e.jsx("div",{children:e.jsxs("div",{children:[L.length>0?L:e.jsx(Q,{countries:t,placeholder:"Форма пошуку турів",selectedPlaces:C,setSelectedPlaces:f,inputText:i,setInputText:w,places:n,searchResponse:c,setSearchResponse:h}),e.jsx(te,{searchResponse:c,setSearchResponse:h})]})})})})}function ae({}){return[{title:"Пошук туру"},{name:"description",content:"Пошук туру"}]}const ie=U(function(){return e.jsx(ne,{})});export{ie as default,ae as meta};
